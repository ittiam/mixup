#!/usr/bin/env node
'use strict';

const path = require('path');
const program = require('commander');
const logger = require('../util/logger');
const isInstalled = require('../util/is-installed');
const npm = require('../util/npm');
const config = require('../util/config');

program.option('-r --registry <registry-url>', '指定镜像').parse(process.argv);

const option = program.args[0] || config.get('template');

if (!option) {
  logger.fatal('请指定脚手架');
}

const name = option;
const template = 'mix-template-' + name;

/**
 * download template
 * @param  {string} template template name
 */
const installTemplate = template => {
  logger.log(`downloading '${template}'`);
  npm.install(template, program.registry);
  logger.success('模板下载成功\n');
};

if (!isInstalled(path.join(template.split('@')[0], 'package.json'))) {
  installTemplate(template);
}

generator(name.split('@')[0]);
